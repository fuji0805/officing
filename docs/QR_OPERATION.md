# QRコード運用ガイド

このドキュメントでは、Officingアプリケーションで使用するQRコードの生成、配置、運用方法について説明します。

## 目次

1. [QRコードの仕組み](#qrコードの仕組み)
2. [QRコードの生成方法](#qrコードの生成方法)
3. [タグの設計](#タグの設計)
4. [QRコードの配置](#qrコードの配置)
5. [運用のベストプラクティス](#運用のベストプラクティス)
6. [トラブルシューティング](#トラブルシューティング)

## QRコードの仕組み

### URL構造

OfficingのQRコードは、以下の形式のURLをエンコードします：

```
https://YOUR_DOMAIN.com/?tag=LOCATION_TAG
```

例：
```
https://yourname.github.io/officing/?tag=officeA
https://yourname.github.io/officing/?tag=meetingRoom1
https://yourname.github.io/officing/?tag=home
```

### チェックインフロー

1. ユーザーがQRコードをスキャン
2. PWAが開き、URLからtagパラメータを抽出
3. 自動的にチェックイン処理を実行
4. 成功画面を表示

### タグの役割

- **場所の識別**: どこでチェックインしたかを記録
- **統計の集計**: タグ別の出社回数を分析
- **称号の獲得**: 特定のタグでのチェックイン回数に応じた称号

## QRコードの生成方法

### 方法1: Webツールを使用（推奨）

#### 1. QRコード生成ページを開く

デプロイ済みのアプリケーションで：
```
https://YOUR_DOMAIN.com/qr-generator.html
```

またはローカルで：
```bash
# ローカルサーバーを起動
python -m http.server 8000

# ブラウザで開く
open http://localhost:8000/qr-generator.html
```

#### 2. タグを入力

- **単一生成**: 1つのタグを入力して「QRコード生成」
- **一括生成**: 複数のタグをカンマ区切りで入力

例：
```
officeA, officeB, meetingRoom1, cafeteria, home
```

#### 3. QRコードをダウンロード

- 生成されたQRコードを右クリック → 「画像を保存」
- または「ダウンロード」ボタンをクリック

#### 4. 印刷または配置

- A4サイズで印刷
- ラミネート加工（推奨）
- 適切な場所に配置

### 方法2: オンラインQRコードジェネレーターを使用

1. [QR Code Generator](https://www.qr-code-generator.com/)などのサービスにアクセス
2. URLタイプを選択
3. チェックインURLを入力：
   ```
   https://YOUR_DOMAIN.com/?tag=YOUR_TAG
   ```
4. QRコードを生成してダウンロード

### 方法3: コマンドラインツール（上級者向け）

```bash
# qrencodeをインストール（macOS）
brew install qrencode

# QRコードを生成
qrencode -o officeA.png "https://YOUR_DOMAIN.com/?tag=officeA"

# 複数のQRコードを一括生成
for tag in officeA officeB meetingRoom1; do
  qrencode -o "${tag}.png" "https://YOUR_DOMAIN.com/?tag=${tag}"
done
```

## タグの設計

### タグの命名規則

#### 推奨フォーマット

```
場所タイプ + 識別子
```

例：
- `office` - メインオフィス
- `officeA`, `officeB` - 複数オフィス
- `meeting1`, `meeting2` - 会議室
- `cafeteria` - カフェテリア
- `entrance` - エントランス
- `home` - 在宅勤務

#### 命名のベストプラクティス

✅ **良い例**:
- `office-tokyo`
- `office-osaka`
- `meeting-room-1`
- `coworking-shibuya`

❌ **避けるべき例**:
- `オフィスA`（日本語は避ける）
- `Office A`（スペースは避ける）
- `office_a_building_3_floor_2`（長すぎる）

### タグの用途別設計

#### 1. 単一オフィス

```
office - メインチェックインポイント
```

シンプルで十分な場合はこれだけでOK。

#### 2. 複数オフィス

```
office-tokyo
office-osaka
office-fukuoka
```

拠点ごとに統計を取りたい場合。

#### 3. オフィス内の詳細な場所

```
entrance       - エントランス
desk-area-1    - デスクエリア1
desk-area-2    - デスクエリア2
meeting-room-a - 会議室A
meeting-room-b - 会議室B
cafeteria      - カフェテリア
lounge         - ラウンジ
```

詳細な行動分析をしたい場合。

#### 4. ハイブリッドワーク

```
office         - オフィス
home           - 在宅
coworking      - コワーキングスペース
client-site    - 客先
```

働く場所を記録したい場合。

### タグ別称号の設定

特定のタグでのチェックイン回数に応じた称号を設定できます。

例：
- `office-tokyo`で30回チェックイン → 「東京マスター」
- `meeting-room-a`で50回チェックイン → 「会議室の主」
- `cafeteria`で100回チェックイン → 「カフェテリアの常連」

設定方法は[Supabaseセットアップガイド](./SUPABASE_SETUP.md)の「称号マスターデータ」を参照。

## QRコードの配置

### 配置場所の選定

#### 必須ポイント

1. **エントランス**: 最も重要なチェックインポイント
2. **受付**: 来訪者が最初に目にする場所

#### オプションポイント

3. **各フロアの入口**: 複数フロアがある場合
4. **会議室**: 会議室利用の記録
5. **カフェテリア**: 休憩時のチェックイン
6. **デスクエリア**: 座席での作業開始時

### 配置のベストプラクティス

#### 高さ

- **推奨**: 床から120-150cm（スマホを持った手の高さ）
- **避ける**: 高すぎる（180cm以上）、低すぎる（80cm以下）

#### 照明

- ✅ 十分な明るさがある場所
- ❌ 直射日光が当たる場所（反射でスキャンしにくい）
- ❌ 暗すぎる場所

#### 視認性

- ✅ 目立つ場所（壁、柱、スタンド）
- ✅ 説明文を添える
- ❌ 隠れた場所、見つけにくい場所

### QRコードのサイズ

| 距離 | 推奨サイズ |
|------|----------|
| 30cm以内 | 3cm × 3cm |
| 50cm | 5cm × 5cm |
| 1m | 10cm × 10cm |
| 2m以上 | 15cm × 15cm以上 |

**推奨**: A4用紙に印刷（約15cm × 15cm）が最も使いやすい。

### 印刷とラミネート

#### 印刷設定

- **用紙**: A4普通紙またはフォト用紙
- **解像度**: 300dpi以上
- **カラー**: モノクロで十分（カラーでも可）

#### ラミネート加工

**推奨理由**:
- 耐久性向上
- 汚れ防止
- 水濡れ防止
- 長期間使用可能

**方法**:
1. 家庭用ラミネーター（2,000円程度）
2. コンビニのラミネートサービス
3. 文房具店のラミネートサービス

### 説明文の追加

QRコードと一緒に説明文を添えると、初めてのユーザーにも分かりやすい。

#### 例1: シンプル

```
━━━━━━━━━━━━━━━
  出社チェックイン
━━━━━━━━━━━━━━━

[QRコード]

スマホでスキャンして
チェックイン！
```

#### 例2: 詳細

```
━━━━━━━━━━━━━━━━━━━━
    Officing チェックイン
━━━━━━━━━━━━━━━━━━━━

[QRコード]

📱 スマホでQRコードをスキャン
✨ 自動的にチェックイン完了
🎁 スタンプ・くじ・クエストで楽しく記録

場所: オフィスA
━━━━━━━━━━━━━━━━━━━━
```

## 運用のベストプラクティス

### 初期導入

#### 1. パイロット運用（1週間）

- 1-2箇所にQRコードを配置
- 少数のユーザーでテスト
- フィードバックを収集

#### 2. 本格導入

- 全ての必要な場所にQRコードを配置
- 全ユーザーに案内
- 使い方のガイドを配布

### 定期メンテナンス

#### 月次チェック

- [ ] QRコードの汚れや破損を確認
- [ ] スキャンしやすさを確認
- [ ] 配置場所の適切性を確認

#### 四半期チェック

- [ ] タグ別のチェックイン統計を確認
- [ ] 使われていないQRコードを撤去
- [ ] 新しい場所へのQRコード追加を検討

### ユーザーサポート

#### よくある質問への対応

**Q: QRコードがスキャンできない**
- カメラの焦点を合わせる
- 照明を確認
- QRコードの汚れを拭く

**Q: チェックインが記録されない**
- ネットワーク接続を確認
- ログイン状態を確認
- 当日既にチェックイン済みでないか確認

**Q: 間違った場所でチェックインしてしまった**
- 当日は1回のみチェックイン可能
- 翌日に正しい場所でチェックイン

### セキュリティ考慮事項

#### QRコードの保護

- ✅ 社内のみに配置
- ✅ 外部に公開しない
- ❌ SNSに投稿しない

#### 不正利用の防止

- 1日1回のみチェックイン可能（システムで制限）
- 認証が必要（未ログインではチェックイン不可）
- チェックイン履歴の監視

## トラブルシューティング

### QRコードがスキャンできない

#### 原因1: QRコードの品質

**症状**: ぼやけている、かすれている

**解決策**:
- 高解像度で再生成（300dpi以上）
- 新しく印刷し直す

#### 原因2: 照明

**症状**: 暗すぎる、反射している

**解決策**:
- 照明を追加
- 配置場所を変更
- マットなラミネートフィルムを使用

#### 原因3: サイズ

**症状**: 小さすぎる、遠すぎる

**解決策**:
- より大きなサイズで印刷
- 配置場所を近くに変更

### チェックインが記録されない

#### 原因1: URL設定

**症状**: QRコードをスキャンしても何も起こらない

**解決策**:
```bash
# URLを確認
# 正しい: https://YOUR_DOMAIN.com/?tag=office
# 間違い: https://YOUR_DOMAIN.com?tag=office (スラッシュなし)
```

#### 原因2: タグの問題

**症状**: エラーメッセージが表示される

**解決策**:
- タグに特殊文字が含まれていないか確認
- 英数字とハイフンのみ使用

#### 原因3: Supabase設定

**症状**: ネットワークエラー

**解決策**:
- Supabaseの Site URL にデプロイ先URLが登録されているか確認
- Edge Functionsがデプロイされているか確認

### タグが正しく記録されない

#### デバッグ方法

1. ブラウザのコンソールを開く（F12）
2. QRコードをスキャン
3. コンソールログを確認

```javascript
// js/checkin.js で確認
console.log('Extracted tag:', tag);
```

## 高度な運用

### 動的QRコード（オプション）

URLを変更せずにリダイレクト先を変更できる動的QRコードサービスを使用すると、QRコードを印刷し直さずにタグを変更できます。

例: [Bitly](https://bitly.com/), [QR Code Generator PRO](https://www.qr-code-generator.com/)

### 分析とレポート

Supabaseのダッシュボードで以下のクエリを実行：

```sql
-- タグ別チェックイン数
SELECT tag, COUNT(*) as count
FROM attendances
WHERE check_in_date >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY tag
ORDER BY count DESC;

-- 時間帯別チェックイン数
SELECT EXTRACT(HOUR FROM check_in_time) as hour, COUNT(*) as count
FROM attendances
WHERE check_in_date >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY hour
ORDER BY hour;

-- 曜日別チェックイン数
SELECT EXTRACT(DOW FROM check_in_date) as day_of_week, COUNT(*) as count
FROM attendances
WHERE check_in_date >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY day_of_week
ORDER BY day_of_week;
```

### A/Bテスト

複数の配置場所やデザインをテストして、最も効果的な方法を見つけます。

例：
- エントランス vs 受付
- 大きいQRコード vs 小さいQRコード
- 説明文あり vs 説明文なし

## チェックリスト

### QRコード生成

- [ ] デプロイ先のURLを確認
- [ ] タグの命名規則を決定
- [ ] 必要な場所のリストを作成
- [ ] QRコードを生成
- [ ] 高解像度で保存（300dpi以上）

### 印刷と配置

- [ ] A4サイズで印刷
- [ ] ラミネート加工
- [ ] 説明文を追加
- [ ] 適切な高さに配置（120-150cm）
- [ ] 照明を確認
- [ ] スキャンテスト

### 運用開始

- [ ] ユーザーに案内
- [ ] 使い方ガイドを配布
- [ ] サポート体制を整備
- [ ] フィードバックを収集

### 定期メンテナンス

- [ ] 月次: QRコードの状態確認
- [ ] 四半期: 統計分析
- [ ] 年次: 配置場所の見直し

---

QRコードの運用について質問がある場合は、GitHubのissueを作成してください。
